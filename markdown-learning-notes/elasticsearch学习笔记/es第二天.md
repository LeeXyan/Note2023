

# ğŸ’®ç›®å½•

[TOC]

## è¿›é˜¶æŸ¥è¯¢

### sortæ’åº

ä»£ç ï¼š

```tiki wiki
GET a1/doc/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    {
      "age": {
        "order": "desc"
      }
    }
  ]
}
```

`desc`æ˜¯é™åºæ’åºï¼Œ`asc`æ˜¯å‡åº

ç»“æœå¦‚ä¸‹ï¼š
![image-20210131212249663](https://gitee.com/yxinmiracle/pic/raw/master/20210131212249.png)

**æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®ç±»å‹éƒ½èƒ½æ’åº**ï¼ï¼ï¼ï¼ï¼ï¼ï¼**

### åˆ†é¡µæŸ¥è¯¢

éšç€æ•°æ®é‡çš„ä¸ç«¯å¢å¤§ï¼ŒæŸ¥è¯¢ç»“æœä¹Ÿå±•ç¤ºçš„è¶Šæ¥è¶Šé•¿ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä»…ä»…åªæ˜¯æŸ¥è¯¢å‡ æ¡æ•°æ®ï¼Œä¸ç”¨å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°åˆ†é¡µæŸ¥è¯¢äº†ã€‚

#### åªè¦æŒ‡å®šçš„æ•°æ®é‡

è¿™ä¸ªä»£ç çš„æ„æ€æ˜¯ä»ç¬¬0ä¸ªå¼€å§‹ç»™2ä¸ª

```tiki wiki
GET a1/doc/_search
{
  "query": {
    "match_all": {}
  },
  "from": 0,
  "size": 2
}
```

### å¸ƒå°”æŸ¥è¯¢

æŸ¥è¯¢cityä¸ºæ²³åŒ—çš„

```tiki wiki
# æŸ¥è¯¢cityæ˜¯æ²³åŒ—çš„
GET a1/doc/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "city": "æ²³åŒ—"
          }
        }
      ]
    }
  }
}
```

ç»“æœï¼š![image-20210131220621232](https://gitee.com/yxinmiracle/pic/raw/master/20210131220621.png)

#### mustå…³é”®å­—--and

æŸ¥è¯¢cityæ˜¯æ²³åŒ—çš„and ageä¸º25

```tiki wiki
# æŸ¥è¯¢cityæ˜¯æ²³åŒ—çš„and ageä¸º25
GET a1/doc/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "city": "æ²³åŒ—"
          }
        },
        {
          "match": {
            "age": 18
          }
        }
      ]
    }
  }
}
```

ç»“æœï¼š

![image-20210131220747733](https://gitee.com/yxinmiracle/pic/raw/master/20210131220747.png)

#### shouldå…³é”®å­—--or

æŸ¥è¯¢cityæ˜¯æ²³åŒ—çš„ ï¼Œæˆ–è€…ageä¸º25

```tiki wiki
# æŸ¥è¯¢cityæ˜¯æ²³åŒ—çš„ ï¼Œæˆ–è€…ageä¸º25
GET a1/doc/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "match": {
            "city": "æ²³åŒ—"
          }
        },
        {
          "match": {
            "age": 18
          }
        }
      ]
    }
  }
}
```

ç»“æœï¼š

![image-20210131220914579](https://gitee.com/yxinmiracle/pic/raw/master/20210131220914.png)

#### must_notå…³é”®å­—--not

æŸ¥è¯¢cityä¸æ˜¯æ²³åŒ—ï¼Œageä¹Ÿä¸æ˜¯18çš„

```tiki wiki
GET a1/doc/_search
{
  "query": {
    "bool": {
      "must_not": [
        {
          "match": {
            "city": "æ²³åŒ—"
          }
        },
        {
          "match": {
            "age": 18
          }
        }
      ]
    }
  }
}
```

ç»“æœï¼š

![image-20210131221012169](https://gitee.com/yxinmiracle/pic/raw/master/20210131221012.png)

#### filterå…³é”®å­—--å¤§äºå°äº

æŸ¥è¯¢cityæ˜¯æ²³åŒ—å’Œå¹´é¾„å¤§äº18

```tiki wiki
# æŸ¥è¯¢cityæ˜¯æ²³åŒ—ï¼Œ å¹´é¾„å¤§äº18
GET a1/doc/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "city": "æ²³åŒ—"
          }
        }
      ],
      "filter": {
        "range": {
          "age": {
            "gt": 18 
          }
        }
      }
    }
  }
}
```

ç»“æœï¼š

![image-20210131221124859](https://gitee.com/yxinmiracle/pic/raw/master/20210131221124.png)

æŸ¥è¯¢cityæ˜¯æ²³åŒ—å’Œå¹´é¾„å¤§äºç­‰äº18

```tiki wiki
# æŸ¥è¯¢cityæ˜¯æ²³åŒ—ï¼Œå¹´é¾„å¤§äºç­‰äº18
GET a1/doc/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "city": "æ²³åŒ—"
          }
        }
      ],
      "filter": {
        "range": {
          "age": {
            "gte": 18 
          }
        }
      }
    }
  }
}
```

ç»“æœï¼š

![image-20210131221243248](https://gitee.com/yxinmiracle/pic/raw/master/20210131221243.png)

å°ç»“ï¼š

- `must`ï¼šä¸å…³ç³»ï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„`and`ã€‚
- `should`ï¼šæˆ–å…³ç³»ï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„`or`ã€‚
- `must_not`ï¼šéå…³ç³»ï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„`not`ã€‚
- `filter`ï¼šè¿‡æ»¤æ¡ä»¶ã€‚
- `range`ï¼šæ¡ä»¶ç­›é€‰èŒƒå›´ã€‚
- `gt`ï¼šå¤§äºï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„`>`ã€‚
- `gte`ï¼šå¤§äºç­‰äºï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„`>=`ã€‚
- `lt`ï¼šå°äºï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„`<`ã€‚
- `lte`ï¼šå°äºç­‰äºï¼Œç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„`<=`ã€‚

### å‡å°‘è¾“å‡ºå­—æ®µï¼Œç»“æœè¿‡æ»¤

å½“æˆ‘ä»¬åœ¨è·å–æ•°æ®çš„æ—¶å€™ï¼Œä¸å¤ªå¸Œæœ›æ‰€æœ‰çš„æ•°æ®éƒ½å±•ç¤ºå‡ºæ¥å°±åƒ`select name from user`çš„sqlè¯­å¥ä¸€æ ·ï¼Œå¯ä»¥å•ç‹¬å°†`name`å­—æ®µæå–å‡ºæ¥ï¼Œè¿™æ ·ä¸ªæ“ä½œçš„ä»£ç æ˜¯åŠ ä¸Š`_source`å­—æ®µè¿›è¡Œç­›é€‰ã€‚

```tiki wiki
# æŸ¥è¯¢cityæ˜¯æ²³åŒ—ï¼Œå¹´é¾„å¤§äºç­‰äº18, æŸ¥è¯¢å‡ºæ¥å¾—æ•°æ®åªè¦city
GET a1/doc/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "city": "æ²³åŒ—"
          }
        }
      ],
      "filter": {
        "range": {
          "age": {
            "gte": 18 
          }
        }
      }
    }
  },
  "_source": ["city"]
}
```

ç»“æœï¼š

![image-20210201094132711](https://gitee.com/yxinmiracle/pic/raw/master/20210201094210.png)



### é«˜äº®æŸ¥è¯¢

å½“æˆ‘ä»¬æƒ³åœ¨æœç´¢å…³é”®å­—çš„æ—¶å€™åŠ é«˜äº®æ˜¾ç¤ºï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨é«˜äº®æŸ¥è¯¢ï¼Œå‡è®¾æˆ‘ä»¬è¿™é‡Œæƒ³åœ¨æè¿°ä¸­æŸ¥è¯¢å¸¦æœ‰`ä¸½è´¨`è¯è¯­çš„æ•°æ®ï¼Œå¹¶ä¸”åŠ ä¸Šé«˜äº®

```tiki wiki
GET a1/doc/_search
{
  "query": {
    "match": {
      "desc": "ä¸½è´¨"
    }
  },
  "_source": ["desc"],
  "highlight": {
    "fields": {
      "desc":{}
    }
  }
}
```

ç»“æœï¼š

![image-20210201095036313](https://gitee.com/yxinmiracle/pic/raw/master/20210201095036.png)

éƒ½ç»™å¥—ä¸Šäº†`<em></em>`æ ‡ç­¾

#### è‡ªå·±åŠ æ ·å¼

è¦æ˜¯æƒ³è‡ªå·±è®¾å®šæ ·å¼å¯ä»¥è¿™ä¹ˆåšï¼š

```tiki wiki
GET a1/doc/_search
{
  "query": {
    "match": {
      "desc": "ä¸½è´¨"
    }
  },
  "_source": ["desc"],
  "highlight": {
    "pre_tags": "<b style='color :grenn'>", 
    "post_tags": "</b>", 
    "fields": {
      "desc":{}
    }
  }
}


```

ç»“æœæ˜¯ï¼š
![image-20210201095436740](https://gitee.com/yxinmiracle/pic/raw/master/20210201095436.png)

### èšåˆå‡½æ•°

æœ€å¤§æœ€å°æ±‚å¹³å‡å°±å¯ä»¥ä½¿ç”¨èšåˆå‡½æ•°

#### æ±‚å¹³å‡å¹´é¾„ï¼ˆavgï¼‰ï¼Œå…¶ä¸­çš„`my_avg`å°±ç›¸å½“ä¸ä¸€ä¸ªåˆ«å

```tiki wiki
# æ±‚å¹³å‡å¹´é¾„
GET a1/doc/_search
{
  "query": {
    "match_all": {}
  },
  "aggs": {
    "my_avg": {
      "avg": {
        "field": "age"
      }
    }
  }
}
```

#### æ±‚æœ€å¤§çš„å¹´é¾„å€¼ï¼ˆmaxï¼‰ï¼š

```tiki wiki
GET a1/doc/_search
{
  "query": {
    "match_all": {}
  },
  "aggs": {
    "NAME": {
      "max": {
        "field": "age"
      }
    }
  },
  "size": 0
}

```

![image-20210201100245988](https://gitee.com/yxinmiracle/pic/raw/master/20210201100246.png)

#### æ±‚å’Œï¼ˆsumï¼‰ï¼š

æ±‚å¹´é¾„çš„å’Œ

```tiki wiki
GET a1/doc/_search
{
  "query": {
    "match_all": {}
  },
  "aggs": {
    "my_sum": {
      "sum": {
        "field": "age"
      }
    }
  },
  "size": 0
}
```

ç»“æœï¼š

![image-20210201100530263](https://gitee.com/yxinmiracle/pic/raw/master/20210201100530.png)

### åˆ†ç»„æŸ¥è¯¢ï¼ˆrangeï¼‰å·¦åŒ…å³ä¸åŒ…

ç°åœ¨æƒ³è¦æŸ¥è¯¢çš„æ‰€æœ‰äººçš„å¹´é¾„æ®µï¼Œå¹¶ä¸”æŒ‰ç…§`15-20ï¼Œ20-25ï¼Œ25ï¼Œ30`åˆ†ç»„ï¼Œå¹¶ä¸”ç®—å‡ºæ¯ç»„çš„å¹³å‡å¹´é¾„

```tiki wiki
GET a1/doc/_search
{
  "size": 0,
  "query": {
    "match_all": {}
  },
  "aggs": {
    "avg_group": {
      "range": {
        "field": "age",
        "ranges": [
          {
            "from": 15,
            "to": 25
          },
          {
            "from": 25,
            "to":30
          },
          {
            "from": 30,
            "to": 35
          }
        ]
      }
    }
  }
}
```

ç»“æœï¼š

![image-20210201101201897](https://gitee.com/yxinmiracle/pic/raw/master/20210201101202.png)

## Mapping

æˆ‘ä»¬å·²ç»è‡ªç”±å¥”æ”¾å¤Ÿäº†ï¼

æˆ‘ä»¬åº”è¯¥çŸ¥é“ï¼Œåœ¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œå¿…é¡»å…ˆå®šä¹‰è¡¨ç»“æ„ï¼Œæ‰èƒ½æ’å…¥æ•°æ®ï¼Œå¹¶ä¸”ï¼Œè¡¨ç»“æ„ä¸ä¼šè½»æ˜“æ”¹å˜ã€‚è€Œæˆ‘ä»¬å‘¢ï¼Œæˆ‘ä»¬æ€ä¹ˆç©elasticsearchçš„å‘¢ï¼Ÿ

æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹`mappings`è¿™ä¸ªå°è€å¼Ÿï¼Œåˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼

#### æ˜ å°„æ˜¯ä»€ä¹ˆï¼Ÿ

å…¶å®ï¼Œæ˜ å°„`mappings`æ²¡é‚£ä¹ˆç¥ç§˜ï¼è¯´ç™½äº†ï¼Œå°±ç›¸å½“äºåŸæ¥ç”±elasticsearchè‡ªåŠ¨å¸®æˆ‘ä»¬å®šä¹‰è¡¨ç»“æ„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦è‡ªå·±æ¥äº†ï¼Œæ—¨åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œæœ‰æ›´å¤šå®šåˆ¶çš„å†…å®¹ï¼Œæ›´åŠ çš„è´´åˆä¸šåŠ¡åœºæ™¯ã€‚OKï¼Œåå¥½äº†ï¼Œå¼€è½¦ï¼
`elasticsearch`ä¸­çš„æ˜ å°„ç”¨æ¥å®šä¹‰ä¸€ä¸ªæ–‡æ¡£åŠå…¶åŒ…å«çš„å­—æ®µå¦‚ä½•å­˜å‚¨å’Œç´¢å¼•çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ˜ å°„æ¥å®šä¹‰ï¼š

- å“ªäº›å­—ç¬¦ä¸²åº”è¯¥è¢«è§†ä¸ºå…¨æ–‡å­—æ®µã€‚
- å“ªäº›å­—æ®µåŒ…å«æ•°å­—ã€æ—¥æœŸæˆ–è€…åœ°ç†ä½ç½®ã€‚
- å®šä¹‰æ—¥æœŸçš„æ ¼å¼ã€‚
- è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œç”¨æ¥æ§åˆ¶åŠ¨æ€æ·»åŠ å­—æ®µçš„çš„æ˜ å°„ã€‚

èº«ä¸ºåƒç“œç¾¤ä¼—çš„å°è€å¼Ÿï¼Œä¸æ‡‚æ²¡å…³ç³»ï¼Œå¾€ä¸‹èµ°ï¼

#### æ˜ å°„ç±»å‹

æ¯ä¸ªç´¢å¼•éƒ½æœ‰ä¸€ä¸ªæ˜ å°„ç±»å‹ï¼ˆè¿™è¯å¿…é¡»æ”¾åœ¨elasticsearch6.xç‰ˆæœ¬åæ‰èƒ½è¯´ï¼Œä¹‹å‰ç‰ˆæœ¬ä¸€ä¸ªç´¢å¼•ä¸‹æœ‰å¤šä¸ªç±»å‹ï¼‰ï¼Œå®ƒå†³å®šäº†æ–‡æ¡£å°†å¦‚ä½•è¢«ç´¢å¼•ã€‚

æ˜ å°„ç±»å‹æœ‰ï¼š

- å…ƒå­—æ®µï¼ˆmeta-fieldsï¼‰ï¼šå…ƒå­—æ®µç”¨äºè‡ªå®šä¹‰å¦‚ä½•å¤„ç†æ–‡æ¡£å…³è”çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚åŒ…æ‹¬æ–‡æ¡£çš„`_index`ã€`_type`ã€`_id`å’Œ`_source`å­—æ®µã€‚
- å­—æ®µæˆ–å±æ€§ï¼ˆfield or propertiesï¼‰ï¼šæ˜ å°„ç±»å‹åŒ…å«ä¸æ–‡æ¡£ç›¸å…³çš„å­—æ®µæˆ–è€…å±æ€§çš„åˆ—è¡¨ã€‚

è¿˜ä¸æ‡‚ï¼Œæ²¡å…³ç³»ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼

#### å­—æ®µçš„æ•°æ®ç±»å‹

- ç®€å•ç±»å‹ï¼Œå¦‚æ–‡æœ¬ï¼ˆ`text`ï¼‰ã€å…³é”®å­—ï¼ˆ`keyword`ï¼‰ã€æ—¥æœŸï¼ˆ`date`ï¼‰ã€æ•´å½¢ï¼ˆ`long`ï¼‰ã€åŒç²¾åº¦ï¼ˆ`double`ï¼‰ã€å¸ƒå°”ï¼ˆ`boolean`ï¼‰æˆ–`ip`ã€‚
- å¯ä»¥æ˜¯æ”¯æŒ`JSON`çš„å±‚æ¬¡ç»“æ„æ€§è´¨çš„ç±»å‹ï¼Œå¦‚å¯¹è±¡æˆ–åµŒå¥—ã€‚
- æˆ–è€…ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œå¦‚`geo_point`ã€`geo_shape`æˆ–`completion`ã€‚

ä¸ºäº†ä¸åŒçš„ç›®çš„ï¼Œä»¥ä¸åŒçš„æ–¹å¼ç´¢å¼•ç›¸åŒçš„å­—æ®µé€šå¸¸æ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²å­—æ®µå¯ä»¥ä½œä¸ºå…¨æ–‡æœç´¢çš„æ–‡æœ¬å­—æ®µè¿›è¡Œç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ’åºæˆ–èšåˆçš„å…³é”®å­—å­—æ®µè¿›è¡Œç´¢å¼•ã€‚æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†åˆ†æå™¨ã€è‹±è¯­åˆ†æå™¨å’Œæ³•è¯­åˆ†æå™¨ç´¢å¼•å­—ç¬¦ä¸²å­—æ®µã€‚

è¿™å°±æ˜¯å¤šå­—æ®µçš„ç›®çš„ã€‚å¤§å¤šæ•°æ•°æ®ç±»å‹é€šè¿‡fieldså‚æ•°æ”¯æŒå¤šå­—æ®µã€‚

#### æ˜ å°„çº¦æŸ

åœ¨ç´¢å¼•ä¸­å®šä¹‰å¤ªå¤šçš„å­—æ®µæœ‰å¯èƒ½å¯¼è‡´æ˜ å°„**çˆ†ç‚¸**ï¼å› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜ä¸è¶³ä»¥åŠéš¾ä»¥æ¢å¤çš„æƒ…å†µï¼Œä¸ºæ­¤ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æˆ–åŠ¨æ€çš„åˆ›å»ºå­—æ®µæ˜ å°„çš„æ•°é‡ï¼š

- index.mapping.total_fields.limitï¼šç´¢å¼•ä¸­çš„æœ€å¤§å­—æ®µæ•°ã€‚å­—æ®µå’Œå¯¹è±¡æ˜ å°„ä»¥åŠå­—æ®µåˆ«åéƒ½è®¡å…¥æ­¤é™åˆ¶ã€‚é»˜è®¤å€¼ä¸º1000ã€‚
- index.mapping.depth.limitï¼šå­—æ®µçš„æœ€å¤§æ·±åº¦ï¼Œä»¥å†…éƒ¨å¯¹è±¡çš„æ•°é‡æ¥è¡¡é‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‰€æœ‰å­—æ®µéƒ½åœ¨æ ¹å¯¹è±¡çº§åˆ«å®šä¹‰ï¼Œåˆ™æ·±åº¦ä¸º1.å¦‚æœæœ‰ä¸€ä¸ªå­å¯¹è±¡æ˜ å°„ï¼Œåˆ™æ·±åº¦ä¸º2ï¼Œç­‰ç­‰ã€‚é»˜è®¤å€¼ä¸º20ã€‚
- index.mapping.nested_fields.limitï¼šç´¢å¼•ä¸­åµŒå¥—å­—æ®µçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º50.ç´¢å¼•1ä¸ªåŒ…å«100ä¸ªåµŒå¥—å­—æ®µçš„æ–‡æ¡£å®é™…ä¸Šç´¢å¼•101ä¸ªæ–‡æ¡£ï¼Œå› ä¸ºæ¯ä¸ªåµŒå¥—æ–‡æ¡£éƒ½è¢«ç´¢å¼•ä¸ºå•ç‹¬çš„éšè—æ–‡æ¡£ã€‚

### mappingsä¹‹dynamicçš„ä¸‰ç§çŠ¶æ€

#### å‰è¨€

ä¸€èˆ¬çš„ï¼Œ`mapping`åˆ™åˆå¯ä»¥åˆ†ä¸ºåŠ¨æ€æ˜ å°„ï¼ˆdynamic mappingï¼‰å’Œé™æ€ï¼ˆæ˜¾å¼ï¼‰æ˜ å°„ï¼ˆexplicit mappingï¼‰å’Œç²¾ç¡®ï¼ˆä¸¥æ ¼ï¼‰æ˜ å°„ï¼ˆstrict mappingsï¼‰ï¼Œå…·ä½“ç”±`dynamic`å±æ€§æ§åˆ¶ã€‚

#### åŠ¨æ€ï¼ˆ"dynamic":trueï¼‰

åŠ¨æ€çš„å°±æ˜¯é»˜è®¤çš„ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„æ“ä½œéƒ½æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬åœ¨esä¸­æ€ä¹ˆå»è®¾å®šdynamicçš„ä¸‰ç§å½¢æ€å‘¢ï¼Ÿ

```tiki wiki
# åŠ¨æ€
PUT a2
{
  "mappings": {
    "doc":{
      "dynamic":true,
      "properties":{
        "name":{
          "type":"text"
        },
        "age":{
          "type":"long"
        }
      }
    }
  }
}
```

é€šè¿‡è¿™è¡Œä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå½“å‰ç´¢å¼•çš„ä¸€äº›é…ç½®

```
GET a2/_mapping
```

ç»“æœï¼š

```json
{
  "a2" : {
    "mappings" : {
      "doc" : {
        "dynamic" : "true",
        "properties" : {
          "age" : {
            "type" : "long"
          },
          "name" : {
            "type" : "text"
          }
        }
      }
    }
  }
}
```

å¯ä»¥æ¸…æ¥šçš„çœ‹å‡ºæ¥`"dynamic" : "true"`

ä¹‹å‰çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å¯ä»¥åšçš„ï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤º

#### é™æ€ï¼ˆ"dynamic":falseï¼‰

é™æ€ç´¢å¼•çš„å»ºç«‹å¦‚ä¸‹ï¼š

```tiki wiki
PUT a3
{
  "mappings": {
    "doc":{
      "dynamic":false,
      "properties":{
        "name":{
          "type":"text"
        },
        "age":{
          "type":"long"
        }
      }
    }
  }
}
```

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¾€è¿™ä¸ªa3ç´¢å¼•æ¥æ·»åŠ ä¸€äº›æ•°æ®å¯¹æ¯”ä¸€ä¸‹é™æ€ä¸åŠ¨æ€çš„åŒºåˆ«

```tiki wiki
PUT a3/doc/1
{
  "name":"ccyxy",
  "age":19
}

PUT a3/doc/2
{
  "name":"cyx",
  "age":19,
  "city":"æ²³åŒ—"
}

PUT a3/doc/3
{
  "age":19,
  "city":"æ²³åŒ—"
}
```

è¿™é‡Œæ·»åŠ çš„æ•°æ®éƒ½æ˜¯æˆåŠŸçš„ï¼Œæˆ‘ä»¬ç°åœ¨æ¥æŸ¥è¯¢ä¸€ä¸‹`name:cyx`çš„æ•°æ®çœ‹çœ‹

```tiki wiki
GET a3/doc/_search
{
  "query": {
    "match": {
      "name": "cyx"
    }
  }
}
```

ç»“æœï¼š

![image-20210201113753887](https://gitee.com/yxinmiracle/pic/raw/master/20210201113753.png)

æ˜¯å¯ä»¥å°†æ•°æ®æŸ¥è¯¢å‡ºæ¥çš„ï¼Œå¹¶ä¸”è¿˜åŒ…å«æˆ‘ä»¬æœªè®¾å®šçš„å­—æ®µ`city`ï¼Œé‚£å¦‚æœæˆ‘ä»¬ä½¿ç”¨`city`å­—æ®µæ¥è¿›è¡ŒæŸ¥è¯¢å‘¢ï¼Ÿ

æˆ‘ä»¬æ¥æŸ¥è¯¢ä¸€ä¸‹`city:æ²³åŒ—`çš„æ•°æ®

```tiki wiki
GET a3/doc/_search
{
  "query": {
    "match": {
      "city": "æ²³åŒ—"
    }
  }
}
```

ç»“æœï¼š

![image-20210201113935429](https://gitee.com/yxinmiracle/pic/raw/master/20210201113935.png)

å¯ä»¥çœ‹å‡ºç»“æœæ˜¯æ²¡æœ‰æ•°æ®ï¼Œ

å¯ä»¥çœ‹åˆ°elasticsearchå¹¶æ²¡æœ‰ä¸ºæ–°å¢çš„`sex`å»ºç«‹æ˜ å°„å…³ç³»ã€‚æ‰€ä»¥æŸ¥è¯¢ä¸åˆ°ã€‚
å½“elasticsearchå¯Ÿè§‰åˆ°æœ‰æ–°å¢å­—æ®µæ—¶ï¼Œå› ä¸º`dynamic:false`çš„å…³ç³»ï¼Œä¼šå¿½ç•¥è¯¥å­—æ®µï¼Œä½†æ˜¯ä»ä¼šå­˜å‚¨è¯¥å­—æ®µã€‚
åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œ`dynamic:false`ä¾ç„¶ä¸å¤Ÿï¼Œæ‰€ä»¥è¿˜éœ€è¦æ›´ä¸¥è°¨çš„ç­–ç•¥æ¥è¿›ä¸€æ­¥åšé™åˆ¶ã€‚

#### ä¸¥æ ¼ï¼ˆ"dynamic":"strict"ï¼‰

åˆ›å»ºä»£ç ï¼š

```tiki wiki
PUT a4
{
  "mappings": {
    "doc":{
      "dynamic":"strict",
      "properties":{
        "name":{
          "type":"text"
        },
        "age":{
          "type":"long"
        }
      }
    }
  }
}

```

å½“æˆ‘ä»¬åŠ å…¥åˆ›å»ºå­—æ®µä¸­æœ‰çš„æ•°æ®æ—¶ï¼š

```
PUT a4/doc/1
{
  "name":"ccyxy",
  "age":19
}
```

è¿™ä¸ªæ’å…¥æ˜¯æˆåŠŸçš„

å½“æˆ‘ä»¬è¦åŠ å…¥æœªåˆ›å»ºå­—æ®µcityæ—¶ï¼š

```tiki wiki
PUT a3/doc/2
{
  "name":"cyx",
  "age":19,
  "city":"æ²³åŒ—"
}
```

ç»“æœï¼š

![image-20210201114444647](https://gitee.com/yxinmiracle/pic/raw/master/20210201114444.png)

å¯ä»¥çœ‹å‡ºåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯ä¸å¯ä»¥è¿™ä¹ˆåšçš„

é”™è¯¯æç¤ºï¼Œä¸¥æ ¼åŠ¨æ€æ˜ å°„å¼‚å¸¸ï¼è¯´äººè¯å°±æ˜¯ï¼Œå½“`dynamic:strict`çš„æ—¶å€™ï¼Œelasticsearchå¦‚æœé‡åˆ°æ–°å­—æ®µï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
ä¸Šè¿°è¿™ç§ä¸¥è°¨çš„ä½œé£æ´’å®¶ç§°ä¸ºâ€”â€”ä¸¥æ ¼æ¨¡å¼ï¼

#### å°ç»“

- åŠ¨æ€æ˜ å°„ï¼ˆdynamicï¼štrueï¼‰ï¼šåŠ¨æ€æ·»åŠ æ–°çš„å­—æ®µï¼ˆæˆ–ç¼ºçœï¼‰ã€‚
- é™æ€æ˜ å°„ï¼ˆdynamicï¼šfalseï¼‰ï¼šå¿½ç•¥æ–°çš„å­—æ®µã€‚åœ¨åŸæœ‰çš„æ˜ å°„åŸºç¡€ä¸Šï¼Œå½“æœ‰æ–°çš„å­—æ®µæ—¶ï¼Œä¸ä¼šä¸»åŠ¨çš„æ·»åŠ æ–°çš„æ˜ å°„å…³ç³»ï¼Œåªä½œä¸ºæŸ¥è¯¢ç»“æœå‡ºç°åœ¨æŸ¥è¯¢ä¸­ã€‚
- ä¸¥æ ¼æ¨¡å¼ï¼ˆdynamicï¼š strictï¼‰ï¼šå¦‚æœé‡åˆ°æ–°çš„å­—æ®µï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚

ä¸€èˆ¬é™æ€æ˜ å°„ç”¨çš„è¾ƒå¤šã€‚å°±åƒ`HTML`çš„`img`æ ‡ç­¾ä¸€æ ·ï¼Œ`src`ä¸ºè‡ªå¸¦çš„å±æ€§ï¼Œä½ å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™æ·»åŠ `id`æˆ–è€…`class`å±æ€§ã€‚
å½“ç„¶ï¼Œå¦‚æœä½ éå¸¸éå¸¸äº†è§£ä½ çš„æ•°æ®ï¼Œå¹¶ä¸”æœªæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´ä¸ä¼šæ”¹å˜ï¼Œ`strict`ä¸å¤±ä¸ºä¸€ä¸ªå¥½é€‰æ‹©ã€‚



### Mappingçš„å…¶ä»–è®¾ç½®

#### index

é¦–å…ˆæ¥åˆ›å»ºä¸€ä¸ª`mappings`ï¼š

```tiki wiki
PUT m4
{
  "mappings": {
    "doc": {
      "dynamic": false,
      "properties": {
        "name": {
          "type": "text",
          "index": true
        },
        "age": {
          "type": "long",
          "index": false
        }
      }
    }
  }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œä¸ºæ¯ä¸ªå±æ€§æ·»åŠ ä¸€ä¸ª`index`å‚æ•°ã€‚é‚£ä¼šæœ‰ä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿ
å…ˆæ¥æ·»åŠ ä¸€ç¯‡æ–‡æ¡£ï¼š

```
PUT m4/doc/1
{
  "name": "ç‹è¹",
  "age": 18
}
```

å†æ¥æŸ¥è¯¢çœ‹æ•ˆæœï¼š

```
GET m4/doc/_search
{
  "query": {
    "match": {
      "name": "ç‹è¹"
    }
  }
}

GET m4/doc/_search
{
  "query": {
    "match": {
      "age": 18
    }
  }
}
```

ä»¥`name`æŸ¥è¯¢æ²¡é—®é¢˜ï¼Œä½†æ˜¯ï¼Œä»¥`age`ä½œä¸ºæŸ¥è¯¢æ¡ä»¶å°±æœ‰é—®é¢˜äº†ï¼š

```json

  "error": {
    "root_cause": [
      {
        "type": "query_shard_exception",
        "reason": "failed to create query: {\n  \"match\" : {\n    \"age\" : {\n      \"query\" : 18,\n      \"operator\" : \"OR\",\n      \"prefix_length\" : 0,\n      \"max_expansions\" : 50,\n      \"fuzzy_transpositions\" : true,\n      \"lenient\" : false,\n      \"zero_terms_query\" : \"NONE\",\n      \"auto_generate_synonyms_phrase_query\" : true,\n      \"boost\" : 1.0\n    }\n  }\n}",
        "index_uuid": "GHBPeT5pRnSi3g6DkpIkow",
        "index": "m4"
      }
    ],
    "type": "search_phase_execution_exception",
    "reason": "all shards failed",
    "phase": "query",
    "grouped": true,
    "failed_shards": [
      {
        "shard": 0,
        "index": "m4",
        "node": "dhkqLLTsRemm7qEgRdpvTg",
        "reason": {
          "type": "query_shard_exception",
          "reason": "failed to create query: {\n  \"match\" : {\n    \"age\" : {\n      \"query\" : 18,\n      \"operator\" : \"OR\",\n      \"prefix_length\" : 0,\n      \"max_expansions\" : 50,\n      \"fuzzy_transpositions\" : true,\n      \"lenient\" : false,\n      \"zero_terms_query\" : \"NONE\",\n      \"auto_generate_synonyms_phrase_query\" : true,\n      \"boost\" : 1.0\n    }\n  }\n}",
          "index_uuid": "GHBPeT5pRnSi3g6DkpIkow",
          "index": "m4",
          "caused_by": {
            "type": "illegal_argument_exception",
            "reason": "Cannot search on field [age] since it is not indexed."
          }
        }
      }
    ]
  },
  "status": 400
}
```

è¿”å›çš„æ˜¯æŠ¥é”™ç»“æœï¼Œè¿™å…¶ä¸­å°±æ˜¯`index`å‚æ•°åœ¨èµ·ä½œç”¨ã€‚

å°ç»“ï¼š`index`å±æ€§é»˜è®¤ä¸º`true`ï¼Œå¦‚æœè¯¥å±æ€§è®¾ç½®ä¸º`false`ï¼Œé‚£ä¹ˆï¼Œ`elasticsearch`ä¸ä¼šä¸ºè¯¥å±æ€§åˆ›å»ºç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•å½“åšä¸»æŸ¥è¯¢æ¡ä»¶ã€‚

#### copy_to

ç°åœ¨ï¼Œå†æ¥å­¦ä¹ ä¸€ä¸ª`copy_to`å±æ€§ï¼Œè¯¥å±æ€§å…è®¸æˆ‘ä»¬å°†å¤šä¸ªå­—æ®µçš„å€¼å¤åˆ¶åˆ°ç»„å­—æ®µä¸­ï¼Œç„¶åå°†ç»„å­—æ®µä½œä¸ºå•ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ã€‚

```tiki wiki
PUT m5
{
  "mappings": {
    "doc": {
      "dynamic":false,
      "properties": {
        "first_name":{
          "type": "text",
          "copy_to": "full_name"
        },
        "last_name": {
          "type": "text",
          "copy_to": "full_name"
        },
        "full_name": {
          "type": "text"
        }
      }
    }
  }
}

PUT m5/doc/1
{
  "first_name":"tom",
  "last_name":"ben"
}
PUT m5/doc/2
{
  "first_name":"john",
  "last_name":"smith"
}

GET m5/doc/_search
{
  "query": {
    "match": {
      "first_name": "tom"
    }
  }
}

GET m5/doc/_search
{
  "query": {
    "match": {
      "full_name": "tom"
    }
  }
}
```

ä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†`first_name`å’Œ`last_name`éƒ½å¤åˆ¶åˆ°`full_name`ä¸­ã€‚å¹¶ä¸”ä½¿ç”¨`full_name`æŸ¥è¯¢ä¹Ÿè¿”å›äº†ç»“æœï¼š

```tiki wiki
{
  "took" : 0,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : 1,
    "max_score" : 0.2876821,
    "hits" : [
      {
        "_index" : "m5",
        "_type" : "doc",
        "_id" : "1",
        "_score" : 0.2876821,
        "_source" : {
          "first_name" : "tom",
          "last_name" : "ben"
        }
      }
    ]
  }
}
```

è¿”å›ç»“æœè¡¨ç¤ºæŸ¥è¯¢æˆåŠŸã€‚é‚£ä¹ˆæƒ³è¦æŸ¥è¯¢`tom`æˆ–è€…`smith`è¯¥æ€ä¹ˆåŠï¼Ÿ

```tiki wiki
GET m5/doc/_search
{
  "query": {
    "match": {
      "full_name": {
        "query": "tom smith",
        "operator": "or"
      }
    }
  }
}
```

ç»“æœï¼Œéƒ½æ˜¯æŸ¥è¯¢åˆ°çš„ï¼š

![image-20210201163422998](https://gitee.com/yxinmiracle/pic/raw/master/20210201163423.png)

è¦æ˜¯å°†å…³ç³»è½¬ä¸ºand

```tiki wiki
GET m5/doc/_search
{
  "query": {
    "match": {
      "full_name": {
        "query": "tom smith",
        "operator": "and"
      }
    }
  }
}
```

ç»“æœï¼š

![image-20210201163514060](https://gitee.com/yxinmiracle/pic/raw/master/20210201163514.png)

`copy_to`è¿˜æ”¯æŒå°†ç›¸åŒçš„å±æ€§å€¼å¤åˆ¶ç»™ä¸åŒçš„å­—æ®µã€‚

```tiki wiki
PUT m6
{
  "mappings": {
    "doc": {
      "dynamic":false,
      "properties": {
        "first_name":{
          "type": "text",
          "copy_to": "full_name"
        },
        "last_name": {
          "type": "text",
          "copy_to": ["field1", "field2"]
        },
        "field1": {
          "type": "text"
        },
        "field2": {
          "type": "text"
        }
      }
    }
  }
}


PUT m6/doc/1
{
  "first_name":"tom",
  "last_name":"ben"
}
PUT m6/doc/2
{
  "first_name":"john",
  "last_name":"smith"
}
```

ä¸Šä¾‹ä¸­ï¼Œåªéœ€è¦å°†`copy_to`çš„å­—æ®µä»¥æ•°ç»„çš„å½¢å¼å°è£…å³å¯ã€‚æ— è®ºæ˜¯é€šè¿‡`field1`è¿˜æ˜¯`field2`éƒ½å¯ä»¥æŸ¥è¯¢ã€‚
å°ç»“ï¼š

- `copy_to`å¤åˆ¶çš„æ˜¯å±æ€§å€¼è€Œä¸æ˜¯å±æ€§
- `copy_to`å¦‚æœè¦åº”ç”¨äºèšåˆè¯·å°†`filddata`è®¾ç½®ä¸º`true`
- å¦‚æœè¦å°†å±æ€§å€¼å¤åˆ¶ç»™å¤šä¸ªå­—æ®µï¼Œè¯·ç”¨æ•°ç»„ï¼Œæ¯”å¦‚`copy_to:["field1", "field2"]`

### å¯¹è±¡å±æ€§

ç°åœ¨ï¼Œæœ‰ä¸€ä¸ªä¸ªäººä¿¡æ¯æ–‡æ¡£å¦‚ä¸‹ï¼š

```tiki wiki
PUT m7/doc/1
{
  "name":"tom",
  "age":18,
  "info":{
    "addr":"åŒ—äº¬",
    "tel":"10010"
  }
}
```

é¦–å…ˆï¼Œè¿™æ ·åµŒå¥—å¤šå±‚çš„`mappings`è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ

```tiki wiki
PUT m7
{
  "mappings": {
    "doc": {
      "dynamic": false,
      "properties": {
        "name": {
          "type": "text"
        },
        "age": {
          "type": "text"
        },
        "info": {
          "properties": {
            "addr": {
              "type": "text"
            },
            "tel": {
              "type" : "text"
            }
          }
        }
      }
    }
  }
}
```

ç°åœ¨å¦‚æœè¦ä»¥`info`ä¸­çš„`tel`ä¸ºæ¡ä»¶æ€ä¹ˆå†™æŸ¥è¯¢è¯­å¥å‘¢ï¼Ÿ

```tiki
GET m7/doc/_search
{
  "query": {
    "match": {
      "info.tel": "10086"
    }
  }
}
```

ä¸Šä¾‹ä¸­ï¼Œ`info`æ—¢æ˜¯ä¸€ä¸ªå±æ€§ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¸º`info`è¿™ç±»å­—æ®µä¸ºå¯¹è±¡å‹å­—æ®µã€‚è¯¥å¯¹è±¡å†…åˆåŒ…å«`addr`å’Œ`tel`ä¸¤ä¸ªå­—æ®µï¼Œå¦‚ä¸Šä¾‹è¿™ç§ä»¥åµŒå¥—å†…çš„å­—æ®µä¸ºæŸ¥è¯¢æ¡ä»¶çš„è¯ï¼ŒæŸ¥è¯¢è¯­å¥å¯ä»¥ä»¥å­—æ®µç‚¹å­å­—æ®µçš„æ–¹å¼æ¥å†™å³å¯ã€‚

## settingsè®¾ç½®

### è®¾ç½®ä¸»ã€å¤åˆ¶åˆ†ç‰‡

åœ¨åˆ›å»ºä¸€ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`settings`ä¸­æŒ‡å®šåˆ†ç‰‡ä¿¡æ¯ï¼š

```tiki wiki
PUT a9
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0
  }
}
```

`number_of_shards`ä¸»åˆ†ç‰‡

`number_of_replicas`å‰¯ä¸»åˆ†ç‰‡

## ignore_above

é•¿åº¦è¶…è¿‡`ignore_above`è®¾ç½®çš„å­—ç¬¦ä¸²å°†ä¸ä¼šè¢«ç´¢å¼•æˆ–å­˜å‚¨ï¼ˆä¸ªäººè®¤ä¸ºä¼šå­˜å‚¨ï¼Œä½†ä¸ä¼šä¸ºè¯¥å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯¥å­—æ®µä¸èƒ½è¢«æ£€ç´¢ï¼‰ã€‚ å¯¹äºå­—ç¬¦ä¸²æ•°ç»„ï¼Œ`ignore_above`å°†åˆ†åˆ«åº”ç”¨äºæ¯ä¸ªæ•°ç»„å…ƒç´ ï¼Œå¹¶ä¸”ä¸ä¼šç´¢å¼•æˆ–å­˜å‚¨æ¯”`ignore_above`æ›´é•¿çš„å­—ç¬¦ä¸²å…ƒç´ ã€‚

```tiki wiki
PUT w1
{
  "mappings": {
    "doc":{
      "properties":{
        "t1":{
          "type":"keyword",
          "ignore_above": 5
        },
        "t2":{
          "type":"keyword",
          "ignore_above": 10   
        }
      }
    }
  }
}
PUT w1/doc/1
{
  "t1":"elk",          
  "t2":"elasticsearch"  
}
GET w1/doc/_search   
{
  "query":{
    "term": {
      "t1": "elk"
    }
  }
}

GET w1/doc/_search  
{
  "query": {
    "term": {
      "t2": "elasticsearch"
    }
  }
}
```

å…¶ä¸­`"t1": "elk"`æ˜¯å¯ä»¥è¿”å›æ•°æ®çš„ï¼Œä½†æ˜¯` "t2": "elasticsearch"`è¿™ä¸ªå¹¶ä¸èƒ½è¿”å›æ•°æ®ï¼Œå› ä¸ºè®¾ç½®äº†`"ignore_above": 10   `ï¼Œä»–å·²ç»è¶…è¿‡äº†é•¿åº¦10

â‘ ï¼Œè¯¥å­—æ®µå°†å¿½ç•¥ä»»ä½•è¶…è¿‡10ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚
â‘¡ï¼Œæ­¤æ–‡æ¡£å·²æˆåŠŸå»ºç«‹ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½è¢«æŸ¥è¯¢ï¼Œå¹¶ä¸”æœ‰ç»“æœè¿”å›ã€‚
â‘¢ï¼Œè¯¥å­—æ®µå°†ä¸ä¼šå»ºç«‹ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥è¯¥å­—æ®µä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œå°†ä¸ä¼šæœ‰ç»“æœè¿”å›ã€‚
â‘£ï¼Œæœ‰ç»“æœè¿”å›ã€‚
â‘¤ï¼Œåˆ™å°†ä¸ä¼šæœ‰ç»“æœè¿”å›ï¼Œå› ä¸º`t2`å­—æ®µå¯¹åº”çš„å€¼é•¿åº¦è¶…è¿‡äº†`ignove_above`è®¾ç½®çš„å€¼ã€‚

è¯¥å‚æ•°å¯¹äºé˜²æ­¢Luceneçš„æœ¯è¯­å­—èŠ‚é•¿åº¦é™åˆ¶ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œé™åˆ¶é•¿åº¦æ˜¯`32766`ã€‚
æ³¨æ„ï¼Œè¯¥ignore_aboveè®¾ç½®å¯ä»¥åˆ©ç”¨ç°æœ‰çš„é¢†åŸŸè¿›è¡Œæ›´æ–°[PUTåœ°å›¾API](https://www.elastic.co/guide/en/elasticsearch/reference/7.0/indices-put-mapping.html)ã€‚
å¯¹äºå€¼`ignore_above`æ˜¯å­—ç¬¦æ•°ï¼Œä½†Luceneçš„å­—èŠ‚æ•°ä¸ºå•ä½ã€‚å¦‚æœæ‚¨ä½¿ç”¨å¸¦æœ‰è®¸å¤šéASCIIå­—ç¬¦çš„UTF-8æ–‡æœ¬ï¼Œæ‚¨å¯èƒ½éœ€è¦è®¾ç½®é™åˆ¶ï¼Œ`32766 / 4 = 8191`å› ä¸ºUTF-8å­—ç¬¦æœ€å¤šå¯å ç”¨4ä¸ªå­—èŠ‚ã€‚
å¦‚æœæˆ‘ä»¬è§‚å¯Ÿä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨è®¾ç½®æ˜ å°„ç±»å‹æ—¶ï¼Œå­—æ®µçš„ç±»å‹æ˜¯`keyword`ï¼Œä¹Ÿå°±æ˜¯è¯´`ignore_above`å‚æ•°ä»…é’ˆå¯¹äº`keyword`ç±»å‹æœ‰ç”¨ã€‚