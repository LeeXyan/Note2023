### 存储引擎

存储引擎 可以说是一种存储数据的方式

一张表中，我们可以分为这几类结构：

```
1.数据
2.表的结构
3.索引
```

---

以下是MySQL中三个引擎的特点：

- 数据和索引存储在一起的方式（2个文件）：
  - Innodb存储引擎
    - 数据持久化
    - 支持事务
    - 支持行级锁 （频繁修改数据的时候有优势）
    - 支持表级锁  （对于大量数据同时修改有优势）
    - 支持外键 

```
数据索引为一个文件
表结构为一个文件
```

- 数据和索引不存储在一起的方式 （3个文件）：
  - Myisam存储引擎
    - 数据持久化
    - 支持表级锁

```
数据
索引
表结构
```

- 数据存储在内存中，也就是数据断电就消失 （1个文件）：
  - Memory存储引擎

```
表结构
```

#### 如何查看MySQL中的各个引擎：

```mysql
show engines;
```

![](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200531075644439.png)

#### 什么是MySQL中的事务呢？

在我们日常的生活中我们会出现一系类的操作，比如我们将300块钱转给别人，以下是数据库中的步骤

```
先找出汇款人的余额
汇款人余额-300
找出收款人的余额
收款人余额+300
```

那如果数据库在执行第三句话的时候挂掉了，那岂不是汇款人的钱少了，收款人钱没有增加。

我们称为这四句话叫做不可拆分的操作，也就是原子性操作，假如我们在运行的过程中挂掉了，我们也会讲前面几个命令进行回滚，也就是不执行

#### 为什么MySQL中有表级锁呢？

为了防止大家对同一张表的同一个数据进行同时操作

#### MySQL外键

下面我们举个简单的例子介绍**mysql外键是什么？**

外键是相对于主键说的，是建立表之间 的联系的必须的前提。

比如这里有两张，user（用户）表和qx（权限）表，user中gid是用户权限id，而gid是依赖于qx中的id。那么qx中的id就是user的外键。

也就是当我们给gid创建一个外键，这个外键就是qx中的id时，gid就必须与qx中id一致，我们可以通过外键使两张表进行关联。

**注意：**MySQL会自动为所有表的主键进行索引，但是外键字段必须由用户进行明确的索引

![1](https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=1153742810,2914268838&fm=173&app=49&f=JPEG?w=531&h=345&s=48A23D72EFC76ADA48F564CA0000E0B1)

### 存储引擎的测试

查看当前的默认存储引擎:

```mysql
mysql> show variables like "default_storage_engine";
+------------------------+--------+
| Variable_name          | Value  |
+------------------------+--------+
| default_storage_engine | InnoDB |
+------------------------+--------+
1 row in set, 1 warning (0.36 sec)
```

#### 在建表时指定

```mysql
mysql> create table ai(id bigint(12),name varchar(200)) ENGINE=MyISAM; 

mysql> create table country(id int(4),cname varchar(50)) ENGINE=InnoDB;

# 也可以使用alter table语句，修改一个已经存在的表的存储引擎。
mysql> alter table ai engine = innodb;
```

查看当前表的引擎（show create table 表名;）：

```mysql
mysql> show create table t1;
+-------+-----------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                    |
+-------+-----------------------------------------------------------------------------------------------------------------+
| t1    | CREATE TABLE `t1` (
  `id` int DEFAULT NULL,
  `name` char(1) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 |
+-------+-----------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
```

##  mysql的工作流程

![3](https://img2018.cnblogs.com/blog/827651/201809/827651-20180928181850055-806373159.png)

MySQL架构总共四层，在上图中以虚线作为划分。
　　首先，最上层的服务并不是MySQL独有的，大多数给予网络的客户端/服务器的工具或者服务都有类似的架构。比如：连接处理、授权认证、安全等。
　　第二层的架构包括大多数的MySQL的核心服务。包括：查询解析、分析、优化、缓存以及所有的内置函数（例如：日期、时间、数学和加密函数）。同时，所有的跨存储引擎的功能都在这一层实现：存储过程、触发器、视图等。

　　第三层包含了存储引擎。存储引擎负责MySQL中数据的存储和提取。服务器通过API和存储引擎进行通信。这些接口屏蔽了不同存储引擎之间的差异，使得这些差异对上层的查询过程透明化。存储引擎API包含十几个底层函数，用于执行“开始一个事务”等操作。但存储引擎一般不会去解析SQL（InnoDB会解析外键定义，因为其本身没有实现该功能），不同存储引擎之间也不会相互通信，而只是简单的响应上层的服务器请求。

　　第四层包含了文件系统，所有的表结构和数据以及用户操作的日志最终还是以文件的形式存储在硬盘上。